plan mode
goals: frame0 디자인 시스템을 만들었는데 최종적으로 moabom 화면에 이 디자인을 적용할꺼야.

## 디자인 시스템
@app/views/sketch_demo/index.html.erb 하위 컴포넌트를 확인하면 되.

## 디자인 적용 프로세스
1. 현재 프로젝트에 적용되어 있는 페이지들 목록화.
   - 목록화 하면서 필요한 컴포넌트들을 정립한다.
2. 디자인 시스템에 정의되어 있지 않은 컴포넌트들이 있는지 확인하고 없다면 추가한다.
3. 페이지 목록을 병렬로 서브 에이전트에 할당하여 반영한다.

지금은 이렇게 처리할 예정이야. 더 확인해야 하는 사항이 있다면 알려주고 계획 먼저 세워줘.

---

http://localhost:3000/ 에서 확인했을 때 피드백 줄꼐 확인해줘.
- alert의 X버튼 클릭하면 안닫혀
- 모아봄 하위 구분선과 body 사이에 흰색 영역이 있는데 이거 없애야해.
- 우리아이의 소중한 순간 문구에서 '중' -> ㅈ만 흰색이야. 의도한건지 확인해줘.
- 개발 모드로 빠른 진입 버튼 클릭해도 아무 동작 없어.

---

http://localhost:3000/ 대시보드 확인했을 때 피드백 줄께 확인해줘.
- AlertComponent의 닫기(X) 버튼 클릭하면 안닫혀.
- main 에 배경색이 적용 안되고 div.sketch-container에 배경색이 적용된거 같은데 의도한거야?

---

대시보드 화면에서 빠른 메뉴의 버튼들과 첫 사진 업로드 버튼 클릭했는데 온보딩 화면으로 이동하고 있어.
문제 파악해줘.

---

모든 화면에서 하단 탭 제거하기로 했는데 안되어 있는 화면들이 있어. 분석해서 계획알려주고 확인 받아.

---

/clarify
대시보드 화면 재 디자인
## 요구사항
- 대시보드에 빠른 메뉴 삭제
- 대시보드에서 인스타 스토리 보여주듯 아이 관리가 되면서 클릭하면 타임라인으로 사진을 보여주고 싶어.
- nav-bar 형식이 아니라 기본적으로 타임라인에는 날짜별 사진을 **Gallery Card - Square** 로 보여주고
  인스타 스토리 같이 아이 프로필을 선택하면 사진에 매핑된 tag가 포함된 사진을 필더링하는거야.
- 사진이 없을때, 사진이 있을때, 필터링 되기 전, 후 모두 디자인을 확인하고 싶어.

---

/home2에 전체 선택하면 선택 영역으로 동그란 선택 표시 위 부분이 짤리고 있어.
그리고 임시로 타임라인 어떻게 보이는지 보여줄 수 있어?

---

타임라인 내에 제목이랑 내용은 없는데 이거 확인해주고 타임라인은 모바일 화면에서 확인하는 사이즈로 맞춰야 할꺼 같아.

---

@promt/img_1.png
타임라인 전체 이미지가 너무 크게 나와 그리고 아래 Bento Grid는 우리 가족 앨범, 소중한 순간들을 모아봤어요 이렇게 있는데 @promt/img_1.png에는 없어.  
Gallery Card (Bento Grid) -> @promt/img.png

---

@promt/img_2.png
타임라인 width가 너무 넓어 조정해줘

---

아직 안되는거 같아. /home2에 연동되는 화면이야.
근본적인 원인을 찾아봐

---

@promt/img_3.png
지금 줄어들었는데 width는 조금 더 줄여야 할꺼 같고 height는 늘려야 할꺼 같아.
비율이 맞게 적용해줘.

---

coderabbit이 리뷰하고 만들어준 리뷰 내용 및 프롬프트야.
`---`으로 구분했어. 서브 에이전트로 병렬 처리해줘.
**누락되는 내용 없어야해.**

Add the sketch-rough-line CSS class definition.

The :rough variant references sketch-rough-line, which is not defined in any CSS file. Add this class to app/assets/stylesheets/sketch-utilities.css with appropriate hand-drawn/sketchy border styling to match the design intent.

---
In app/helpers/home2_helper.rb around lines 5 to 14, the method uses nested
if/elsif and multiple respond_to? checks; refactor to use guard clauses and the
safe navigation operator: return demo_image_url early when present, return the
url_for(photo.image.variant(:thumbnail)) when photo.image&.attached? is true,
otherwise return the placeholder URL; remove respond_to? checks and nested
branching to improve clarity and follow style guidelines.
---
In app/views/errors/_error_page.html.erb around lines 13 to 18, the template
currently nests a button element (Sketch::ButtonComponent) inside a link
(link_to), producing invalid HTML and breaking keyboard/screen‑reader behavior;
replace the outer link_to with button_to (HTTP GET) so the ButtonComponent
renders as a standalone <button>, or change the ButtonComponent to render as an
anchor (if it supports a :tag or :as option) and remove the button markup—ensure
the final markup is not a button inside an anchor, preserves intended navigation
(GET), and keeps classes/ARIA attributes for accessibility.
---
In app/views/families/children/_child.html.erb around line 24, the view calls
child.photos.count causing N+1 queries because the controller loads @children
without preloading photos; update the controller action that sets @children (the
family children index loader) to preload the photos association by adding an
includes(:photos) when querying @family.children so counts are fetched without
per-child queries.
---
In app/views/families/children/_form.html.erb around lines 44 to 48, remove the
link_to block that wraps the Sketch::ButtonComponent (invalid nesting of a
button inside an anchor) and instead render the Sketch::ButtonComponent by
itself with a navigation attribute (e.g., href or url) set to
family_children_path(@family) — if the component does not support an href,
replace the block with a plain link_to that uses the same button CSS classes and
text (“취소”) so no <button> element is nested inside an <a>.
---
In app/views/families/children/edit.html.erb around lines 1 to 6, the template
dereferences @child.name directly which will raise NoMethodError if @child is
nil; update the view to guard against nil by rendering a safe fallback — either
use safe navigation (e.g. @child&.name) with a default string when name is nil,
or wrap the header and form render in a conditional that only renders when
@child is present and otherwise shows an appropriate fallback message or
redirects; ensure the chosen approach covers both @child being nil and
@child.name being nil.
---
In app/views/families/children/index.html.erb around lines 25-30, the current
code nests a Sketch::ButtonComponent inside a link_to, producing invalid HTML;
replace the link_to wrapping the button with either a button_to
new_family_child_path(@family), method: :get that renders the ButtonComponent's
content as the button, or update Sketch::ButtonComponent to accept an href (or
to render as an anchor when href is provided) and call the component with href:
new_family_child_path(@family) so the component outputs a single valid
anchor/button element instead of nesting.
---
In app/views/families/photos/edit.html.erb around lines 4 to 7, the link_to
calls family_photo_path(@family, @photo) without guarding against nil and will
raise a routing error if @family or @photo is nil; update the view to check for
presence of both instance variables (e.g. if @family.present? &&
@photo.present?) and only render the link when both exist, otherwise render a
safe fallback (a disabled span or a link to a safe route such as families_path
or family_path(@family) when only @family exists); ensure you do not call
family_photo_path unless both objects are non-nil.
---
In app/views/home2/_empty_state.html.erb lines 1-8, the partial calls
new_family_photo_path(@family) assuming @family is always set; change the
action_href to guard against nil (e.g., use safe navigation / conditional): if
@family is present, pass new_family_photo_path(@family), otherwise provide a
safe fallback (nil, '#' or a sensible route like families_path/root_path) to
avoid NoMethodError.
---
In app/views/home2/_photo_card.html.erb around lines 31 to 37, the template
checks photo.child.present? but calls photo.child.name.truncate which will raise
if name is nil; change the rendering to guard the name by converting it to a
string or falling back to an empty string before calling truncate (e.g. use
photo.child.name.to_s.truncate(...) or (photo.child.name || "").truncate(...))
so nil names won’t raise.
---
In app/views/invitations/show.html.erb around lines 16-20 and 25-29 the
Sketch::ButtonComponent is nested inside button_to which generates a form;
because the component renders a <button type="button"> by default the outer form
submission is blocked. Fix both occurrences by passing type: :submit to the
ButtonComponent so it renders as a submit button, ensuring the outer button_to
form submits correctly and the HTML is valid.
---
Remove misleading Stimulus controller references; HTML declares gender-select controller that doesn't exist.

The gender selection buttons declare a Stimulus controller (data-controller="gender-select") with actions (selectFemale, selectMale) and targets, but the actual controller file (app/javascript/controllers/gender_select_controller.js) does not exist. The functionality is implemented entirely in the inline script below (lines 91-122).

Either create the missing Stimulus controller and remove the inline script, or remove all Stimulus attributes from the HTML (lines 6, 10-11, 17-18, 22) and rely solely on the inline script. The current state is misleading—developers will search for a non-existent controller file.
---
In app/views/onboarding/children/show.html.erb around lines 68 to 87 (and the
duplicate implementation at ~116-120), the Stimulus action data: { action:
"click->navigation#goToInvite" } on the "나중에 할게요" button is duplicated by an
inline script implementing the same function; remove the inline duplicate and
keep the Stimulus-based handler (or alternatively move the inline code into the
navigation Stimulus controller), making sure the navigation controller defines
goToInvite and that the data-action string matches the controller identifier and
method name.
---
In app/views/onboarding/children/show.html.erb around lines 91 to 122, the
inline script implements Stimulus behavior that should live in controllers;
create app/javascript/controllers/gender_select_controller.js with targets for
female, male, and input and actions selectFemale() and selectMale() to set
input.value and toggle the CSS classes exactly as in the inline script, create
app/javascript/controllers/navigation_controller.js with an action goToInvite()
that reads a data attribute for the invite path and navigates there, update the
view (around line 83) to pass the invite path via a data attribute (e.g.
data-navigation-invite-path="<%= onboarding_invite_path %>"), and then remove
the entire inline <script> block (lines 91–122).
---
In app/views/onboarding/invites/show.html.erb around lines 52-73, the second
button is posting to complete_onboarding_invite_path which immediately completes
onboarding despite its text saying "나중에 초대할게요" (I'll invite you later); change
the second button so it either posts to a different controller action that
defers invitation (e.g., a new postpone_onboarding_invite_path or update action
that sets a "defer" flag) or, if the intent is to also complete onboarding,
update the button text to unambiguously indicate it completes onboarding (e.g.,
"초대는 나중에, 완료" or similar). Ensure the route/method and controller handle the new
defer behavior (create a route and controller action to record deferral and
redirect appropriately) or update only the label if no behavior change is
desired.
---
Add nil safeguards for user nickname access.

Multiple chained calls to comment.user.nickname lack nil checks. If comment.user or nickname is nil, this will raise NoMethodError. Additionally, nickname.to_s.first returns nil for empty strings, which may cause issues with the Avatar component's initials prop.
---
In app/views/sessions/new.html.erb lines 22-36: the Kakao section wraps a
Sketch::ButtonComponent (which outputs a <button>) inside link_to creating
invalid nested interactive elements; change the markup so the outer link does
not contain a button element — either use button_to "/auth/kakao", method: :get
and remove the outer link, or keep link_to but render a non-button element
(update the component call to render as an anchor or replace it with a plain
<span>/<div> styled like the button) to avoid <a><button> nesting. For Apple and
Google buttons (lines 22-24 and 34-36) either wire them to real OmniAuth routes
(e.g. /auth/apple and /auth/google_oauth2) so they perform sign-in, or
explicitly mark them disabled/unavailable (pass disabled: true or add
aria-disabled and remove click behavior) until providers/routes are implemented.
---
In test/components/sketch/empty_state_component_test.rb around lines 59 to 63,
the test uses assert_no_selector "a.sketch-btn" which is ineffective because the
component does not render an element with class sketch-btn; update the assertion
to target the actual rendered link text or tag (for example assert_no_selector
"a", text: "Add Photo" or another selector matching the real action link) so the
test reliably verifies the absence of the action button.
---
In test/system/accessibility_test.rb around lines 48 to 51, the test lowers the
touch target check to 32px and the inline comment says 40px — both are incorrect
and violate WCAG/iOS/Android guidance; change the assertions to require a 44px
minimum (assert height >= 44, assert width >= 44) and update the comment to
clearly state the 44px minimum requirement per WCAG 2.2 / platform guidance (or
add a linked justification if an exception is needed).
---
In test/system/families/members_test.rb around lines 112-113, the current
assertion uses assert_no_selector "button[aria-label]", text: "관리" which only
checks visible text and will miss cases where "관리" is inside the aria-label
attribute; replace it with an attribute-aware selector (e.g. assert_no_selector
'button[aria-label*="관리"]' or a more specific exact-match selector like
'button[aria-label="관리"]') so the test asserts there are no buttons whose
aria-label contains (or equals) "관리".
---
In test/system/layout_test.rb around lines 64 to 75, the test uses a conditional
guard `if has_selector?("header")` which masks a missing header and weakens test
coverage; remove the conditional and replace it with a hard assertion that the
header exists (e.g., assert_selector "header") and then scope the link check
with within "header" { assert_selector "a[href='#{notifications_path}']" } so
the test fails when the header is absent and correctly verifies the notification
link for logged-in users.
---
In test/system/layout_test.rb around lines 80 to 89, the test name "플래시 메시지 표시"
claims to verify flash messages but only checks that the main selector exists;
either rename the test to reflect that it only validates page load (e.g., "메인
페이지 로드" or "페이지 로드 후 메인 존재") or implement a real flash-message assertion:
perform an action that sets a flash (or stub it), visit the page where the flash
should appear, and add assertions that the flash container (selector used by
your app, e.g., ".flash" or "#flash") contains the expected text and CSS class
for the flash type.
---
Add explicit error message validation.

The test name indicates it should verify error display ("에러 표시"), but it only checks that the page path remains unchanged. This doesn't confirm that users actually see helpful error feedback.

Issues:

No assertion for error message content or presence
Same execute_script usage concern as the success test (see comment on lines 40-41)

---

coderabbit이 리뷰하고 만들어준 리뷰 내용 및 프롬프트야.
`---`으로 구분했어. 서브 에이전트로 병렬 처리해줘.
**누락되는 내용 없어야해.**

In app/helpers/home2_helper.rb around lines 5 to 14, the method uses nested
if/elsif and multiple respond_to? checks; refactor to use guard clauses and the
safe navigation operator: return demo_image_url early when present, return the
url_for(photo.image.variant(:thumbnail)) when photo.image&.attached? is true,
otherwise return the placeholder URL; remove respond_to? checks and nested
branching to improve clarity and follow style guidelines.
---
In app/views/onboarding/children/show.html.erb around lines 91 to 122, the
inline script implements Stimulus behavior that should live in controllers;
create app/javascript/controllers/gender_select_controller.js with targets for
female, male, and input and actions selectFemale() and selectMale() to set
input.value and toggle the CSS classes exactly as in the inline script, create
app/javascript/controllers/navigation_controller.js with an action goToInvite()
that reads a data attribute for the invite path and navigates there, update the
view (around line 83) to pass the invite path via a data attribute (e.g.
data-navigation-invite-path="<%= onboarding_invite_path %>"), and then remove
the entire inline <script> block (lines 91–122).
---
In app/views/onboarding/invites/show.html.erb around lines 52-73, the second
button is posting to complete_onboarding_invite_path which immediately completes
onboarding despite its text saying "나중에 초대할게요" (I'll invite you later); change
the second button so it either posts to a different controller action that
defers invitation (e.g., a new postpone_onboarding_invite_path or update action
that sets a "defer" flag) or, if the intent is to also complete onboarding,
update the button text to unambiguously indicate it completes onboarding (e.g.,
"초대는 나중에, 완료" or similar). Ensure the route/method and controller handle the new
defer behavior (create a route and controller action to record deferral and
redirect appropriately) or update only the label if no behavior change is
desired.
---
In app/assets/stylesheets/sketch-utilities.css around lines 386 to 416, the
entire .sketch-rough-line rule set (including ::before and ::after) is
duplicated elsewhere in the file; remove the duplicate occurrence so only a
single definition remains, keeping the intended styles (border, pseudo-elements,
opacities, transforms and pointer-events) in one place and delete the redundant
block to avoid wasted bytes and maintenance confusion.
---
In app/views/sessions/new.html.erb around lines 22 to 26, the Apple and Google
OAuth buttons point to /auth/apple and /auth/google while only Kakao is
configured in OmniAuth (and omniauth-apple/omniauth-google gems/credentials are
not installed), causing broken links; either remove or disable these buttons
until providers are fully configured or implement full provider setup. Fix by
temporarily removing or replacing the button_to blocks for Apple and Google with
non-functional "Coming soon" UI (or hide them via feature flag) OR fully add
provider support: add the required omniauth-apple/omniauth-google gems, add
provider configuration and credentials in config/initializers/omniauth.rb,
ensure callback routes are present and tested, and only render the buttons when
the provider is configured (e.g., check ENV or a feature flag) to prevent broken
user flows.
---
In app/views/sessions/new.html.erb around lines 22 to 40 there are invalid
nested buttons because button_to (which renders a form with a submit button)
wraps Sketch::ButtonComponent (which itself renders a <button>); fix by removing
the nested button element: either (A) stop using Sketch::ButtonComponent inside
button_to and apply the component’s classes directly to the button_to content
(render plain text or a span with the same classes), or (B) update
Sketch::ButtonComponent to support a non-button tag (eg. an `as` or `tag` option
that renders a span/div) and pass that option when using it inside button_to so
the outer submit button is the only button element; pick one approach and update
the three provider blocks consistently.
---
