<%# 사진 카드 - Square 스타일 (인스타그램 스타일) %>
<% is_demo = photo.respond_to?(:demo_image_url) && photo.demo_image_url.present? %>
<% photo_url = is_demo ? "#" : family_photo_path(@family, photo) %>

<%= link_to photo_url,
    class: "block aspect-square overflow-hidden bg-sketch-cream relative group",
    data: { turbo_frame: "_top" } do %>

  <% if is_demo %>
    <%# 데모 이미지 (picsum.photos) %>
    <%= image_tag photo.demo_image_url,
        class: "w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",
        loading: "lazy",
        alt: "사진" %>
  <% elsif photo.respond_to?(:image) && photo.image.respond_to?(:attached?) && photo.image.attached? %>
    <%# 실제 이미지 %>
    <%= image_tag photo.image.variant(:thumbnail),
        class: "w-full h-full object-cover transition-transform duration-200 group-hover:scale-105",
        loading: "lazy",
        alt: photo.caption.presence || "사진" %>
  <% else %>
    <%# 이미지 없을 때 플레이스홀더 %>
    <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-sketch-cream to-sketch-gray/20">
      <svg class="w-8 h-8 text-sketch-gray/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
      </svg>
    </div>
  <% end %>

  <%# 아이 태그 배지 (있을 경우) %>
  <% if photo.child.present? %>
    <div class="absolute bottom-1 left-1">
      <%= render Sketch::BadgeComponent.new(variant: :default, size: :sm) do %>
        <%= photo.child&.name.to_s.truncate(4, omission: "") %>
      <% end %>
    </div>
  <% end %>
<% end %>
